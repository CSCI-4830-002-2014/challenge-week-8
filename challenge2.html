<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>D3</title>
        <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/d3/3.4.12/d3.min.js"></script>
        <style type="text/css">  
        </style>
    </head>
    <body>
        <script type="text/javascript">
            var w = 1000;
            var h = 600;        
            var margin = 100;
 
            var dataset = [
              { 'quadrant': 1,
                'size': 20,
                'x': 20,
                'y': 45,
                'energy': 15,
                'angle': Math.PI/4,
                'distance': 20
              },
              { 'quadrant': 2,
                'size': 50,
                'x': 30,
                'y': 15,
                'energy': 5,
                'angle': Math.PI/3,
                'distance': 40
              },
              { 'quadrant': 3,
                'size': 25,
                'x': 25,
                'y': 65,
                'energy': 10, 
                'angle': -Math.PI/3,
                'distance': 30
              },
              { 'quadrant': 4,
                'size': 30,
                'x': 35,
                'y': 25,
                'energy': 20,                                          
                'angle': -Math.PI/4,
                'distance': 40
              },              
            ];            
           
            var svg = d3.select("body")          
                        .append("svg")
                        .attr("width", w)
                        .attr("height", h);
 
          var yScale = d3.scale.linear()
            .domain([0, d3.max(dataset.map(function(d) {
              return d.y
            }))])
            .range([margin, h - margin]);
 
          var xScale = d3.scale.linear()
            .domain([0, d3.max(dataset.map(function(d) {
              return d.x
            }))])
            .range([margin, w - margin]);            
 
            symbol = svg.selectAll("g")
              .data(dataset)
              .enter()
              .append("g")
              .attr("transform", function(d, i) {
                return "translate(" + xScale(d.x) + "," + yScale(d.y) +")";
              });
            
            symbol.append("rect")          
                .attr("width", function(d) { return d.size})
                .attr("height", function(d) { return d.size})
                .attr("fill", "red");

            symbol.append("circle") 
                .attr("r", function(d){
                  return d.size/4;
                })            
                .attr("cx", function(d){
                  if (d.quadrant == 1 || d.quadrant == 4){
                      return 3*d.size/4; 
                  }else{
                      return d.size/4; ; 
                  }
                })
                .attr("cy", function(d){
                  if (d.quadrant == 3 || d.quadrant == 4){
                      return 3*d.size/4; 
                  }else{
                      return d.size/4; 
                  }
                })                
              .attr("fill", "blue");

              symbol.append("rect")
                .attr("width", function(d,i){
                    return 10;
                })
                .attr("height", function(d,i){
                    return d.energy; 
                })                
                .attr("x", function(d){
                    return d.size/2 - 5; 
                })
                .attr("y", function(d){
                    return d.size; 
                })                
              .attr("fill", "black"); 

              // symbol.append("text")
              //   .text(function(d) {return "(Q: " + d.quadrant + ", L: " + d.distance + ")" ;})
              //   .attr('x', function(d) {return -d.size/2;})
              //   .attr('y', function(d) {return -d.size;})
              //   .attr("font-family", "sans-serif")
              //   .attr("font-size", "20px")
              //   .attr("fill", "black");

              symbol.append("circle")
                .attr("r", function(d){
                  return 5;
                })            
                .attr("cx", function(d){
                  if (d.quadrant == 1 || d.quadrant == 4){
                      return 3*d.size/4 + d.distance*Math.cos(d.angle); 
                  }else{
                      return d.size/4 + d.distance*Math.cos(d.angle); 
                  }
                })
                .attr("cy", function(d){
                  if (d.quadrant == 3 || d.quadrant == 4){
                      return 3*d.size/4+ d.distance*Math.sin(d.angle); 
                  }else{
                      return d.size/4 + d.distance*Math.sin(d.angle); 
                  }
                })                
                .attr("fill", "skyblue"); 

                // //****Angle Circle *****
                // symbol.append("circle")
                //   .attr("r", function(d){
                //     return d.size;
                //   })            
                //   .attr("cx", function(d){
                //       return d.size/2;
                //   })
                //   .attr("cy", function(d){
                //     return d.size/2;
                // })                
                // .attr("opacity", 1)
                // .attr("fill","none")
                // .attr("stroke","black")
                // .attr("stroke-width",10);
                // //****End Circle *******

                symbol.append("line")
                  .attr("x1", function (d){
                  if (d.quadrant == 1 || d.quadrant == 4){    
                      return 3*d.size/4; 
                  }else{
                      return d.size/4; 
                  }
                })
                .attr("y1", function(d){
                  if (d.quadrant == 3 || d.quadrant == 4){
                      return 3*d.size/4; 
                  }else{
                      return d.size/4; 
                  }
                })   
                .attr("x2", function (d){
                if (d.quadrant == 1 || d.quadrant == 4){    
                    return 3*d.size/4 + Math.cos(d.angle)*d.distance; 
                }else{
                    return d.size/4 + Math.cos(d.angle)*d.distance; 
                }
              })
              .attr("y2", function(d){
                if (d.quadrant == 3 || d.quadrant == 4){
                    return 3*d.size/4 + Math.sin(d.angle)*d.distance; 
                }else{
                    return d.size/4 + Math.sin(d.angle)*d.distance; 
                }
              })          
                  .attr("stroke-width", 2)
                  .attr("stroke", "black");
 
        </script>
    </body>
</html>